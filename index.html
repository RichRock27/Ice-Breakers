<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Property Alliance Presents: Icebreaker Experience</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    :root {
      --brand: #c67c48;
      --brand-dark: #995a33;
      --charcoal: #1f1f1f;
      --muted: #6b7280;
      --ok: #34a853;
      --danger: #e23a2b;
      --card: #ffffffcc;
      --gold: #ffd700;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: Inter, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--charcoal);
      background: radial-gradient(1200px 600px at 10% -10%, #ffe9dc 0, transparent 70%),
        radial-gradient(900px 500px at 110% 10%, #ffe3f0 0, transparent 60%),
        linear-gradient(120deg, #fff8f3, #fff);
      overflow-x: hidden;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 28px;
    }

    .blob {
      position: fixed;
      border-radius: 50%;
      filter: blur(40px);
      opacity: .28;
      animation: float 14s ease-in-out infinite;
      pointer-events: none;
    }

    .b1 {
      width: 360px;
      height: 360px;
      left: -80px;
      top: -100px;
      background: #ffd3bb;
      animation-delay: 0s
    }

    .b2 {
      width: 300px;
      height: 300px;
      right: -60px;
      top: 120px;
      background: #ffd9e7;
      animation-delay: 2s
    }

    .b3 {
      width: 260px;
      height: 260px;
      left: 30%;
      bottom: -120px;
      background: #ffe8cf;
      animation-delay: 1s
    }

    @keyframes float {
      50% {
        transform: translateY(-12px) translateX(8px) scale(1.04)
      }
    }

    .wrap {
      width: min(1100px, 96vw);
      position: relative;
    }

    /* Sound Toggle */
    .sound-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      background: var(--card);
      backdrop-filter: blur(12px);
      border: 1px solid #fff;
      border-radius: 50px;
      padding: 8px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .1);
      cursor: pointer;
      transition: all .3s;
    }

    .sound-toggle:hover {
      transform: scale(1.05);
    }

    .sound-toggle .icon {
      font-size: 20px;
    }

    .sound-toggle .label {
      font-size: 12px;
      font-weight: 700;
      color: var(--muted);
    }

    .sound-toggle.muted .icon {
      opacity: .4;
    }

    /* Hero */
    .hero {
      background: var(--card);
      backdrop-filter: blur(12px);
      border: 1px solid #ffffff;
      border-radius: 20px;
      padding: 18px 20px;
      box-shadow: 0 16px 48px rgba(0, 0, 0, .10);
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 4px 0;
    }

    .brand img {
      width: 44px;
      height: 44px;
      object-fit: contain;
      filter: drop-shadow(0 1px 0 rgba(0, 0, 0, .06));
    }

    .brand h1 {
      margin: 0;
      font-size: 26px;
      color: var(--brand);
      letter-spacing: .3px;
    }

    .sparkle {
      font-size: 22px;
      animation: pop .6s ease;
    }

    @keyframes pop {
      0% {
        transform: scale(.7)
      }

      70% {
        transform: scale(1.1)
      }

      100% {
        transform: scale(1)
      }
    }

    .toolbar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: end;
      margin-left: auto;
    }

    label {
      font-weight: 700
    }

    .field {
      display: flex;
      gap: 10px;
      align-items: center;
      background: #fff;
      border: 1px solid #eceff3;
      padding: 10px;
      border-radius: 12px;
    }

    input[type="number"] {
      width: 120px;
      padding: 10px 12px;
      border: 1px solid #d8dde4;
      border-radius: 10px;
      font-size: 16px;
    }

    button {
      padding: 12px 16px;
      border: none;
      border-radius: 12px;
      font-weight: 800;
      color: #fff;
      cursor: pointer;
      background: var(--brand);
      transition: transform .16s ease, filter .16s ease, box-shadow .16s ease;
      box-shadow: 0 6px 16px rgba(198, 124, 72, .26);
      position: relative;
      overflow: hidden;
    }

    button:hover {
      filter: brightness(.98);
      transform: translateY(-1px);
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
      transform: none
    }

    .secondary {
      background: #6a6f7b;
      box-shadow: 0 6px 16px rgba(0, 0, 0, .18);
    }

    .danger {
      background: var(--danger);
      box-shadow: 0 6px 16px rgba(226, 58, 43, .25);
    }

    .helper {
      color: var(--muted);
      font-size: 12px;
      margin-top: 4px;
    }

    /* Participant Card */
    .participant-card {
      background: var(--card);
      backdrop-filter: blur(12px);
      border: 1px solid #fff;
      border-radius: 16px;
      padding: 18px 22px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 16px 48px rgba(0, 0, 0, .10);
    }

    .participant-card .label {
      font-weight: 700;
      font-size: 18px;
    }

    .participant-card .name {
      font-weight: 900;
      font-size: 20px;
      color: var(--brand-dark);
    }

    .participant-card .buttons {
      display: flex;
      gap: 10px;
    }

    /* CINEMATIC OVERLAY */
    .cinematic-overlay {
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: #000;
      display: none;
      align-items: center;
      justify-content: center;
      animation: fadeIn .5s ease;
    }

    .cinematic-overlay.active {
      display: flex;
    }

    @keyframes fadeIn {
      from {
        opacity: 0
      }

      to {
        opacity: 1
      }
    }

    /* Host Avatar */
    .host-container {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 300px;
      opacity: 0;
      animation: hostRise 1s ease forwards;
    }

    @keyframes hostRise {
      from {
        transform: translateX(-50%) translateY(100px);
        opacity: 0;
      }

      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    .host-avatar {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      border: 6px solid var(--gold);
      box-shadow: 0 20px 60px rgba(198, 124, 72, .4),
        0 0 80px rgba(255, 215, 0, .3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 120px;
      position: relative;
      overflow: hidden;
    }

    .host-avatar::before {
      content: '';
      position: absolute;
      inset: -50%;
      background: conic-gradient(from 0deg, transparent, rgba(255, 215, 0, .3), transparent);
      animation: rotate 3s linear infinite;
    }

    @keyframes rotate {
      to {
        transform: rotate(360deg);
      }
    }

    .host-avatar .emoji {
      position: relative;
      z-index: 2;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, .3));
    }

    /* Cinematic Text */
    .cinematic-text {
      position: absolute;
      top: 15%;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      width: 90%;
      max-width: 800px;
    }

    .presents {
      font-size: 18px;
      letter-spacing: 8px;
      color: var(--brand);
      text-transform: uppercase;
      opacity: 0;
      animation: fadeInUp 1s ease .5s forwards;
    }

    @keyframes fadeInUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .title {
      font-size: 64px;
      font-weight: 900;
      color: #fff;
      text-shadow: 0 4px 20px rgba(198, 124, 72, .6);
      margin: 20px 0;
      opacity: 0;
      animation: titleZoom 1s ease 1s forwards;
    }

    @keyframes titleZoom {
      from {
        transform: scale(.8);
        opacity: 0;
      }

      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .subtitle {
      font-size: 24px;
      color: var(--brand);
      font-style: italic;
      opacity: 0;
      animation: fadeInUp 1s ease 1.5s forwards;
    }

    /* Countdown */
    .countdown {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 200px;
      font-weight: 900;
      color: var(--gold);
      text-shadow: 0 0 40px rgba(255, 215, 0, .8);
      opacity: 0;
    }

    .countdown.show {
      animation: countPulse .8s ease;
    }

    @keyframes countPulse {
      0% {
        transform: translate(-50%, -50%) scale(.5);
        opacity: 0;
      }

      50% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1;
      }

      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
      }
    }

    /* Decoy Preview */
    .decoy-preview {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, .1);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 215, 0, .3);
      border-radius: 16px;
      padding: 20px 40px;
      color: #fff;
      font-size: 20px;
      opacity: 0;
      white-space: nowrap;
    }

    .decoy-preview.show {
      animation: decoyFlash .6s ease;
    }

    @keyframes decoyFlash {

      0%,
      100% {
        opacity: 0;
        transform: translateX(-50%) scale(.9);
      }

      50% {
        opacity: 1;
        transform: translateX(-50%) scale(1);
      }
    }

    /* Participant Spotlight */
    .participant-spotlight {
      position: absolute;
      top: 30%;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      opacity: 0;
    }

    .participant-spotlight.show {
      animation: spotlightReveal 1.5s ease forwards;
    }

    @keyframes spotlightReveal {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .participant-spotlight .label {
      font-size: 24px;
      color: var(--brand);
      letter-spacing: 4px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .participant-spotlight .name {
      font-size: 72px;
      font-weight: 900;
      color: #fff;
      text-shadow: 0 4px 30px rgba(198, 124, 72, .8);
    }

    /* Question Reveal */
    .question-reveal {
      position: absolute;
      top: 35%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 900px;
      text-align: center;
      opacity: 0;
    }

    .question-reveal.show {
      animation: questionSlide 1.2s ease forwards;
    }

    @keyframes questionSlide {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(40px);
      }

      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .question-reveal .badge {
      display: inline-block;
      background: var(--gold);
      color: #000;
      padding: 8px 20px;
      border-radius: 50px;
      font-weight: 900;
      font-size: 16px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(255, 215, 0, .4);
    }

    .question-reveal .text {
      font-size: 36px;
      line-height: 1.4;
      color: #fff;
      font-weight: 700;
      text-shadow: 0 2px 20px rgba(0, 0, 0, .5);
    }

    /* Main content cards */
    .row {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 16px;
      margin-top: 12px;
    }

    @media (max-width:860px) {
      .row {
        grid-template-columns: 1fr
      }
    }

    .card {
      background: var(--card);
      border: 1px solid #fff;
      border-radius: 16px;
      padding: 18px 20px;
      box-shadow: 0 16px 48px rgba(0, 0, 0, .10);
    }

    /* Results Display */
    .results-display {
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 30px;
    }

    .results-display .number {
      display: inline-block;
      background: var(--brand);
      color: #fff;
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 15px;
      box-shadow: 0 4px 12px rgba(198, 124, 72, .3);
    }

    .results-display .question-text {
      font-size: 22px;
      line-height: 1.5;
      color: var(--charcoal);
    }

    .results-display .participant-name {
      color: var(--brand-dark);
      font-weight: 900;
    }

    /* Side card */
    .side h3 {
      margin: 0 0 8px;
      color: var(--brand-dark);
      font-size: 15px;
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    .last {
      background: #fff;
      border: 1px solid #eceff3;
      border-left: 4px solid var(--brand);
      border-radius: 12px;
      padding: 12px;
    }

    .last .badge {
      background: #fff3ea;
      color: #9a5b36;
      border-radius: 8px;
      padding: 4px 8px;
      font-weight: 800;
      margin-right: 8px;
    }

    .last .when {
      color: var(--muted);
      font-size: 12px;
      margin-top: 6px
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 24px;
      transform: translateX(-50%);
      background: #111827;
      color: #fff;
      padding: 10px 14px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .2);
      z-index: 9999;
      font-size: 14px;
    }

    .ripple::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at var(--x) var(--y), #ffffff66, transparent 40%);
      opacity: 0;
      transition: opacity .4s;
      pointer-events: none;
    }

    .ripple:active::after {
      opacity: 1;
      transition: none
    }
  </style>
</head>

<body>
  <!-- Floating blobs -->
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>

  <!-- Sound Toggle -->
  <div class="sound-toggle" id="soundToggle" onclick="toggleSound()">
    <span class="icon" id="soundIcon">üîä</span>
    <span class="label" id="soundLabel">Sound On</span>
  </div>

  <!-- Cinematic Overlay -->
  <div class="cinematic-overlay" id="cinematicOverlay">
    <div class="cinematic-text">
      <div class="presents">Property Alliance Presents</div>
      <div class="title">ICEBREAKER</div>
      <div class="subtitle">The Experience</div>
    </div>
    <div class="host-container">
      <div class="host-avatar">
        <div class="emoji">üé≠</div>
      </div>
    </div>
    <div class="countdown" id="countdown"></div>
    <div class="decoy-preview" id="decoyPreview"></div>
    <div class="participant-spotlight" id="participantSpotlight">
      <div class="label">Today's Participant</div>
      <div class="name" id="spotlightName"></div>
    </div>
    <div class="question-reveal" id="questionReveal">
      <div class="badge" id="questionBadge">#0</div>
      <div class="text" id="questionText"></div>
    </div>
  </div>

  <div class="wrap">
    <!-- HERO -->
    <div class="hero">
      <div class="brand">
        <img src="https://drive.google.com/thumbnail?id=1hUtTkrmARHGCojTaR1iMUO6aNFrTHEdn&sz=w64"
          alt="Property Alliance logo" />
        <h1>Icebreaker Game</h1>
        <div class="sparkle">‚ú®</div>
      </div>
      <div class="toolbar">
        <div>
          <label id="rangeLabel">Type a number:</label>
          <div class="field">
            <input type="number" id="numInput" min="1" inputmode="numeric" />
            <button id="useBtn" class="ripple" onclick="useNumber()">Use</button>
          </div>
          <div class="helper">Tip: Press Enter to use</div>
        </div>
        <div>
          <button id="randBtn" class="secondary ripple" onclick="pickRandom()">Pick Random üé≤</button>
          <button id="resetBtn" class="danger ripple" onclick="resetAll()">Reset All ‚ùå</button>
          <span id="loading" class="helper" style="display:none; margin-left:8px;">Working‚Ä¶</span>
        </div>
      </div>
    </div>

    <!-- PARTICIPANT PICKER -->
    <div class="participant-card">
      <div>
        <span class="label">üé§ Today's Participant: </span>
        <span class="name" id="currentParticipant">‚Äî</span>
      </div>
      <div class="buttons">
        <button onclick="pickParticipant()">üéØ Pick</button>
        <button class="secondary" onclick="repickParticipant()">üîÅ Repick</button>
      </div>
    </div>

    <!-- MAIN ROW -->
    <div class="row">
      <div class="card">
        <div class="results-display" id="resultsDisplay">
          <p style="color:var(--muted); font-size:18px;">Ready to roll! Pick a participant and a question ‚ú®
          </p>
        </div>
      </div>

      <aside class="card side">
        <h3>Last Week</h3>
        <div class="last" id="lastBox">
          <div><span class="badge" id="lastNum">‚Äî</span><span id="lastText">No pick saved yet.</span></div>
          <div class="when" id="lastWhen">‚Äî</div>
        </div>
      </aside>
    </div>

    <div id="toasts"></div>
  </div>

  <script>
    // MOCK BACKEND DATA WITH 200 QUESTIONS
    const QUESTIONS = [
      "If you could have dinner with any historical figure, who would it be?",
      "What is the most useless talent you have?",
      "If you could instantly become an expert in anything, what would it be?",
      "What's the best piece of advice you‚Äôve ever received?",
      "If you won the lottery tomorrow, what's the first thing you'd buy?",
      "What's your most used emoji?",
      "If you could only eat one meal for the rest of your life, what would it be?",
      "What's the most unusual place you've ever visited?",
      "If you could have any superpower, what would it be?",
      "What's your favorite way to spend a day off?",
      "If you could live in any fictional world, which one would it be?",
      "What's the best book you've read recently?",
      "If you could swap lives with someone for a day, who would it be?",
      "What's your biggest pet peeve?",
      "If you could time travel, where and when would you go?",
      "What's the most daring thing you've ever done?",
      "If you could have any animal as a pet, what would it be?",
      "What's your favorite childhood memory?",
      "If you were stranded on a desert island, what three things would you want with you?",
      "What's the best concert you've ever been to?",
      "If you could be any fictional character for a day, who would you choose?",
      "What‚Äôs your favorite thing about your current job?",
      "If you could only listen to one album for the rest of your life, what would it be?",
      "What‚Äôs the weirdest food you‚Äôve ever tried?",
      "If you could travel anywhere in the world right now, where would you go?",
      "What is your go-to karaoke song?",
      "If you could meet any person, living or dead, who would it be?",
      "What‚Äôs the most interesting thing you‚Äôve learned recently?",
      "If you had a warning label, what would yours say?",
      "What's the first thing you do when you get home from work?",
      "What is your favorite holiday and why?",
      "If you could have any job in the world, what would it be?",
      "What is your favorite childhood movie?",
      "What do you think is the best invention of all time?",
      "If you could speak any other language fluently, what would it be?",
      "What's the most impulsive thing you've ever done?",
      "What's your favorite board game?",
      "If you could be famous for one thing, what would it be?",
      "What's the best gift you've ever received?",
      "What would your dream house look like?",
      "What's your favorite season and why?",
      "If you could invite three people (dead or alive) to a dinner party, who would they be?",
      "What's your favorite smell?",
      "If you could only have one app on your phone, what would it be?",
      "What's the best piece of advice you've ever given someone?",
      "If you were a superhero, what would your name and power be?",
      "What's the most beautiful place you've ever seen?",
      "What's your favorite way to de-stress?",
      "If you had to live in a different country, where would you go?",
      "What's the most memorable dream you've ever had?",
      "If you could only eat one food for the rest of your life, what would it be?",
      "What's your favorite thing about yourself?",
      "What's the best purchase you've ever made?",
      "If you could be an expert at any musical instrument, what would it be?",
      "What's the best movie you've seen in the last year?",
      "If you could go back in time and change one thing, what would it be?",
      "What's your favorite book of all time?",
      "What's the best vacation you've ever been on?",
      "If you could be an Olympic athlete, what sport would you compete in?",
      "What is your favorite thing to do on a rainy day?",
      "If you could have any animal as a sidekick, which one would you pick?",
      "What's the most adventurous thing you've ever done?",
      "If you could only watch one TV show for the rest of your life, what would it be?",
      "What's your favorite type of music?",
      "If you could have any view from your bedroom window, what would it be?",
      "What is the best concert you've ever attended?",
      "If you could be any animal, what would you be and why?",
      "What's your favorite way to spend a morning?",
      "If you were a color, which one would you be?",
      "What's the most important thing you've learned in your career so far?",
      "If you could win an award for anything, what would it be?",
      "What is your favorite comfort food?",
      "If you could write a book, what would it be about?",
      "What's your favorite thing about the town you live in?",
      "If you could have a conversation with any animal, which one would it be?",
      "What is your favorite way to get exercise?",
      "If you could go to dinner with any fictional character, who would it be?",
      "What's the most interesting fact you know?",
      "If you could be a character in any movie, which one would you choose?",
      "What's your favorite type of weather?",
      "If you could meet your future self, what one question would you ask?",
      "What is your favorite thing to cook (or eat)?",
      "What's the best advice your parents ever gave you?",
      "If you could have a limitless supply of one thing, what would it be?",
      "What's the most unusual talent you've ever seen someone have?",
      "If you could be any mythological creature, what would you be?",
      "What's your favorite way to spend a weekend?",
      "If you could change one thing about the world, what would it be?",
      "What's the best part of your day?",
      "If you could spend a day with any celebrity, who would it be?",
      "What is your favorite song to listen to when you're happy?",
      "If you were an ice cream flavor, what would you be?",
      "What's the most interesting hobby you've ever had?",
      "If you could be a contestant on any game show, which one would it be?",
      "What is your favorite place in your home?",
      "If you could have a personal chef or a personal driver, which would you pick?",
      "What is the most thoughtful gift you've ever given?",
      "If you could witness any event in history, what would it be?",
      "What is the most unique thing about you?",
      "If you could have any fictional technology, what would it be?",
      "What is your favorite way to spend a quiet evening?",
      "If you could name a planet, what would you call it?",
      "What is the best part of your childhood you still remember?",
      "If you could swap jobs with someone for a week, who would it be?",
      "What is your favorite dessert?",
      "If you could be any historical figure for a day, who would it be?",
      "What is the most useful piece of tech you own?",
      "If you could have a super-speed or super-strength, which would you choose?",
      "What is your favorite memory with your friends?",
      "If you could be a fly on the wall in any room, which one would it be?",
      "What is the most interesting thing you can see from your window?",
      "If you were to start a podcast, what would it be about?",
      "What's your favorite quote?",
      "If you could live in any era of history, which one would it be?",
      "What is the best restaurant you've ever been to?",
      "If you could be a master of any craft, what would it be?",
      "What's the most courageous thing you've ever done?",
      "If you could have a dream job for just one day, what would it be?",
      "What is your favorite board game or card game?",
      "If you could be any character from a book you've read, who would it be?",
      "What's your favorite way to start the day?",
      "If you could have any view for your office, what would it be?",
      "What's the most interesting place you've traveled to?",
      "If you could learn any dance, what would it be?",
      "What's your favorite smell in the world?",
      "If you could be a professional athlete in any sport, which would it be?",
      "What is your favorite way to relax on a Friday night?",
      "If you were to write a movie script, what genre would it be?",
      "What is the best piece of news you've heard recently?",
      "If you could go on a mission to Mars, would you go?",
      "What is your favorite childhood toy?",
      "If you could have any fictional animal as a pet, what would it be?",
      "What is the best thing about where you live now?",
      "If you could be a pro at any video game, which one would it be?",
      "What is your favorite way to spend a snowy day?",
      "If you could have any collection (stamps, cars, etc.), what would it be?",
      "What is the most inspiring movie you've ever seen?",
      "If you could swap lives with a fictional character, who would it be?",
      "What is your favorite type of art?",
      "If you could have any fountain in your garden (chocolate, water, juice), what would it be?",
      "What is the best thing you've ever cooked?",
      "If you could meet the person who invented your favorite thing, who would it be?",
      "What is your favorite way to celebrate a success?",
      "If you could have any vintage item (car, clothes, etc.), what would it be?",
      "What is your favorite memory from a regular day?",
      "If you could only wear one color for the rest of your life, what would it be?",
      "What is your favorite type of architecture?",
      "If you were an explorer, where would you want to go?",
      "What is the best concert you've ever heard a recording of?",
      "If you could have a conversation with your ancestors, what would you ask?",
      "What is your favorite way to give back to the community?",
      "If you could be a mentor to someone, what would you teach them?",
      "What is the most interesting piece of art you've ever seen?",
      "If you could have a giant version of any small thing, what would it be?",
      "What is your favorite thing about your best friend?",
      "If you could be any piece of furniture, what would you be?",
      "What is the most useful skill you have?",
      "If you could spend a month in any city, where would it be?",
      "What is your favorite flower?",
      "If you could be the world record holder for anything, what would it be?",
      "What is the best meal you've ever had outdoors?",
      "If you could create a new flavor of chips, what would it be?",
      "What is your favorite thing to do with your family?",
      "If you could have a room in your house dedicated to one activity, what would it be?",
      "What is the most interesting mystery you've ever heard of?",
      "If you could spend a day as an animal, which one would you pick?",
      "What is your favorite sound in nature?",
      "If you could have a magical garden, what would grow in it?",
      "What is the best thing about being the age you are now?",
      "If you could have a wardrobe that led to another world, where would it go?",
      "What is your favorite childhood tradition?",
      "If you could be a chef in any type of restaurant, what would it be?",
      "What is the most creative thing you've ever done?",
      "If you could spend a week in a castle, where would it be?",
      "What is your favorite part of a museum?",
      "If you could have a personal library with every book ever written, what would you read first?",
      "What is the most interesting thing you've found on the ground?",
      "If you could have any view for a sunset, where would you be?",
      "What is your favorite way to use your imagination?",
      "If you could have a picnic anywhere, where would it be?",
      "What is the best costume you've ever worn?",
      "If you could have a time capsule, what would you put in it?",
      "What is your favorite way to spend a Sunday afternoon?",
      "If you could be an expert at any board game, which one would it be?",
      "What is the most inspiring person you've met?",
      "If you could have any fictional house as your own, which one would it be?",
      "What is your favorite thing to do on a beach?",
      "If you could be a character in a classic novel, who would you be?",
      "What is the most interesting piece of trivia you know?",
      "If you could have a personal astronomer, what would you want to see?",
      "What is your favorite thing about your hometown?",
      "If you could have a party with any theme, what would it be?",
      "What is the most resilient thing you've ever seen?",
      "If you could have a personal robot, what would you name it?",
      "What is your favorite part of the day?",
      "If you could have any view from a mountain top, where would it be?",
      "What is the most interesting thing you've learned from a stranger?",
      "If you could have a conversation with a tree, what would it tell you?",
      "What is your favorite way to be kind?",
      "If you could have a personal time-stopper, what would you do with it?",
      "What is your favorite way to spend a rainy morning?"
    ];

    // MOCK API
    let usedQuestions = [];
    const mockApi = {
      getQuestionCount: () => QUESTIONS.length,
      getLastPick: () => {
        const lp = localStorage.getItem('ib_last_pick');
        return lp ? JSON.parse(lp) : null;
      },
      setLastPick: (data) => {
        localStorage.setItem('ib_last_pick', JSON.stringify(data));
      },
      showManualQuestion: (num) => {
        const idx = (num - 1) % QUESTIONS.length;
        return { number: num, question: QUESTIONS[idx] };
      },
      pickRandomIcebreaker: () => {
        const r = Math.floor(Math.random() * QUESTIONS.length);
        return { number: r + 1, question: QUESTIONS[r] };
      },
      resetAllQuestions: () => {
        usedQuestions = [];
      }
    };

    // Window google object
    window.google = {
      script: {
        run: {
          withSuccessHandler: (cb) => {
            return {
              getQuestionCount: () => cb(mockApi.getQuestionCount()),
              getLastPick: () => cb(mockApi.getLastPick()),
              showManualQuestion: (n) => cb(mockApi.showManualQuestion(n)),
              pickRandomIcebreaker: () => cb(mockApi.pickRandomIcebreaker()),
              setLastPick: (d) => mockApi.setLastPick(d),
              resetAllQuestions: () => { mockApi.resetAllQuestions(); cb(); }
            }
          },
          withFailureHandler: () => this,
          setLastPick: (d) => mockApi.setLastPick(d)
        }
      }
    };

    // Sound management
    let soundEnabled = true;
    function toggleSound() {
      soundEnabled = !soundEnabled;
      const toggle = document.getElementById('soundToggle');
      const icon = document.getElementById('soundIcon');
      const label = document.getElementById('soundLabel');
      if (soundEnabled) {
        toggle.classList.remove('muted');
        icon.textContent = 'üîä';
        label.textContent = 'Sound On';
      } else {
        toggle.classList.add('muted');
        icon.textContent = 'üîá';
        label.textContent = 'Sound Off';
      }
    }

    function playSound(frequency, duration) {
      if (!soundEnabled) return;
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.frequency.value = frequency;
        gain.gain.value = 0.1;
        osc.start();
        setTimeout(() => osc.stop(), duration);
      } catch (e) { }
    }

    // Decoy questions (never actually selected, just for show!)
    const decoyQuestions = [
      "üé§ Sing the Property Alliance theme song!",
      "üï∫ Show us your best dance move!",
      "üé≠ Do your best manager impression!",
      "üì± Reveal your phone's wallpaper!",
      "üòÖ Share your most embarrassing typo!",
      "üé® Draw a property on the whiteboard!",
      "üéµ Hum your favorite song!",
      "ü§™ Make the weirdest face you can!",
    ];

    // Elements
    let currentParticipantName = null;
    const input = document.getElementById('numInput');
    const useBtn = document.getElementById('useBtn');
    const randBtn = document.getElementById('randBtn');
    const resetBtn = document.getElementById('resetBtn');
    const loading = document.getElementById('loading');
    const rangeLabel = document.getElementById('rangeLabel');
    const lastNum = document.getElementById('lastNum');
    const lastText = document.getElementById('lastText');
    const lastWhen = document.getElementById('lastWhen');
    const resultsDisplay = document.getElementById('resultsDisplay');

    // Cinematic elements
    const overlay = document.getElementById('cinematicOverlay');
    const countdown = document.getElementById('countdown');
    const decoyPreview = document.getElementById('decoyPreview');
    const participantSpotlight = document.getElementById('participantSpotlight');
    const spotlightName = document.getElementById('spotlightName');
    const questionReveal = document.getElementById('questionReveal');
    const questionBadge = document.getElementById('questionBadge');
    const questionText = document.getElementById('questionText');

    function setBusy(b) {
      [useBtn, randBtn, resetBtn, input].forEach(el => el.disabled = b);
      loading.style.display = b ? 'inline' : 'none';
    }

    function setCount(count) {
      input.max = String(count || 1);
      rangeLabel.textContent = `Type a number (1‚Äì${count || 1}):`;
    }

    async function showCinematicExperience(result) {
      // Show overlay
      overlay.classList.add('active');
      playSound(220, 200);

      // Wait for intro
      await sleep(2500);

      // Show decoy previews (3 random decoys)
      for (let i = 0; i < 3; i++) {
        const decoy = decoyQuestions[Math.floor(Math.random() * decoyQuestions.length)];
        decoyPreview.textContent = decoy;
        decoyPreview.classList.add('show');
        playSound(330 + i * 50, 150);
        await sleep(700);
        decoyPreview.classList.remove('show');
        await sleep(200);
      }

      // Countdown 3...2...1...
      for (let i = 3; i >= 1; i--) {
        countdown.textContent = i;
        countdown.classList.add('show');
        playSound(440, 200);
        await sleep(800);
        countdown.classList.remove('show');
        await sleep(200);
      }

      // Show participant
      if (currentParticipantName) {
        spotlightName.textContent = currentParticipantName;
        participantSpotlight.classList.add('show');
        playSound(550, 300);
        await sleep(2000);
        participantSpotlight.classList.remove('show');
        await sleep(500);
      }

      // Show question
      questionBadge.textContent = '#' + result.number;
      questionText.textContent = result.question;
      questionReveal.classList.add('show');
      playSound(660, 500);

      // Confetti!
      try {
        confetti({ particleCount: 200, spread: 90, origin: { y: .4 }, colors: ['#c67c48', '#ffd700', '#fff'] });
        setTimeout(() => {
          confetti({ particleCount: 100, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#c67c48', '#ffd700'] });
          confetti({ particleCount: 100, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#c67c48', '#ffd700'] });
        }, 300);
      } catch (e) { }

      await sleep(4000);

      // Hide overlay
      questionReveal.classList.remove('show');
      await sleep(500);
      overlay.classList.remove('active');

      // Show in results
      displayResult(result);

      // Save
      google.script.run.setLastPick({ number: result.number, question: result.question, ts: Date.now() });
      loadLastPick();
    }

    function displayResult(r) {
      const intro = currentParticipantName ? `<span class="participant-name">${currentParticipantName}</span>, your question is:` : '';
      resultsDisplay.innerHTML = `
      <div class="number">#${r.number}</div>
      <div class="question-text">${intro}<br><br>${r.question}</div>
    `;
    }

    function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

    function useNumber() {
      const val = input.value;
      if (val === '' || isNaN(Number(val))) return jiggle(input);
      setBusy(true);
      google.script.run
        .withSuccessHandler(r => { setBusy(false); showCinematicExperience(r); })
        .showManualQuestion(parseInt(val, 10));
    }

    function pickRandom() {
      setBusy(true);
      google.script.run
        .withSuccessHandler(r => { setBusy(false); showCinematicExperience(r); })
        .pickRandomIcebreaker();
    }

    function resetAll() {
      if (!confirm('Reset all USED marks and strike-throughs?')) return;
      setBusy(true);
      google.script.run
        .withSuccessHandler(() => { setBusy(false); toast('Reset complete'); })
        .resetAllQuestions();
    }

    function jiggle(el) { el.animate([{ transform: 'translateX(0)' }, { transform: 'translateX(-5px)' }, { transform: 'translateX(5px)' }, { transform: 'translateX(0)' }], { duration: 250 }); }
    function toast(msg) { const d = document.createElement('div'); d.className = 'toast'; d.textContent = msg; document.body.appendChild(d); setTimeout(() => d.remove(), 1600); }

    document.querySelectorAll('.ripple').forEach(btn => {
      btn.addEventListener('pointerdown', e => {
        const r = btn.getBoundingClientRect();
        btn.style.setProperty('--x', (e.clientX - r.left) + 'px');
        btn.style.setProperty('--y', (e.clientY - r.top) + 'px');
      });
    });

    function loadLastPick() {
      google.script.run.withSuccessHandler(data => {
        if (!data) { lastNum.textContent = '‚Äî'; lastText.textContent = 'No pick saved yet.'; lastWhen.textContent = '‚Äî'; return; }
        lastNum.textContent = '#' + data.number;
        lastText.textContent = data.question || '';
        lastWhen.textContent = formatWhen(data.ts);
      }).getLastPick();
    }

    function formatWhen(ts) {
      if (!ts) return '‚Äî';
      const d = new Date(ts);
      return `Saved ${d.toLocaleDateString()} ${d.toLocaleTimeString()}`;
    }

    // INIT
    google.script.run.withSuccessHandler(setCount).getQuestionCount();
    loadLastPick();
    document.getElementById('numInput').addEventListener('keydown', e => { if (e.key === 'Enter') useNumber(); });

    // PARTICIPANT PICKER
    const employeeList = ['Rich', 'Zack', 'Lulu', 'Lauren', 'Brad', 'Chase', 'Matt'];
    let previousPick = null;
    let pickHistory = [];

    function pickParticipant() {
      const available = employeeList.filter(name => !pickHistory.includes(name));
      let candidateList = available.length > 0 ? available : employeeList;

      let selected;
      do {
        selected = candidateList[Math.floor(Math.random() * candidateList.length)];
      } while (selected === previousPick && employeeList.length > 1);

      animateNameRoll(selected);
      previousPick = selected;

      if (!pickHistory.includes(selected)) pickHistory.push(selected);
      if (pickHistory.length >= employeeList.length) pickHistory = [];
    }

    // Add repick function to global scope
    window.repickParticipant = function () {
      pickParticipant();
    }

    // Fix: Make pickParticipant global
    window.pickParticipant = pickParticipant;

    function animateNameRoll(finalName) {
      const display = document.getElementById('currentParticipant');
      const duration = 1200;
      const interval = 60;
      let t = 0;

      const timer = setInterval(() => {
        const name = employeeList[Math.floor(Math.random() * employeeList.length)];
        display.textContent = name;
        playSound(300 + Math.random() * 100, 30);
        t += interval;
        if (t >= duration) {
          clearInterval(timer);
          display.textContent = finalName;
          currentParticipantName = finalName;
          playSound(550, 300);
          try {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.3 }, colors: ['#c67c48', '#ffd700'] });
          } catch (e) { }
        }
      }, interval);
    }
  </script>
</body>

</html>